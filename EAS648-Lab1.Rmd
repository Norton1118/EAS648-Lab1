---
title: "EAS648-Lab1"
author: "Sumire Yamada"
date: "2025-10-24"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r}
library(ggplot2)
library(sf)
library(tidyverse)
```

## Including Plots

You can also embed plots, for example:

```{r}
# be self-contained in the chunk
library(sf)

dsn   <- "G:/My Drive/000_25_Fall/EAS648/EAS648-Lab1/BolderSocialmedia"
sf::st_layers(dsn)  

boulder <- sf::st_read(dsn = dsn, layer = "BoulderSocialMedia", quiet = FALSE)
boulder
```
```{r}
ggplot() +
    geom_sf(data =boulder,
    fill = NA, alpha = .2) +
    theme_bw()
```
```{r}
boulder = st_transform(boulder, 26753) 
ggplot() +
    geom_sf(data =boulder,
    fill = NA, alpha = .2) +
    theme_bw()
```

```{r}
ggplot() +
    geom_sf(data =boulder, aes(color=PT_Elev),
    fill = NA, alpha = .2) +
    theme_bw()
```
```{r}
ggplot() +
    geom_sf(data =boulder, aes(color=PT_Elev),
    fill = NA, alpha = .2) +
  scale_colour_gradientn(colours = terrain.colors(10)) +  
  theme_bw()
```

```{r}
#library(dplyer)
boulder %>%
    mutate(high_elev = ifelse(PT_Elev >= 2200, TRUE, FALSE))%>% 
ggplot() +
  geom_sf(aes(color=high_elev),
    fill = NA, alpha = .2)  +  
  theme_bw()
```

```{r}
boulder %>%
  filter(DB ==  'Pano' | DB == 'Flickr') %>%
  ggplot(aes(x=DB, y=Street_dis)) + 
  geom_boxplot()
```
```{r}
library(sf)
library(ggspatial)
library(viridis)
```
```{r}
magma(10)
```

```{r}
boulder <- st_read("G:/My Drive/000_25_Fall/EAS648/EAS648-Lab1/BolderSocialmedia/BoulderSocialMedia.shp")
```

```{r}
ggplot() +
    geom_sf(data = boulder, aes(color=PT_Elev),
    fill = NA, alpha = .2) + 
    scale_colour_gradientn(colours = magma(10))
```
```{r}
summary(boulder$DB)
```

```{r}
p <- ggplot() +
  annotation_spatial(boulder) +
  layer_spatial(boulder, aes(col = DB))
p + scale_color_brewer(palette = "Dark2")
```
```{r}
library(tmap)
```
```{r}
## Add the data - these are specific to the vector or raster
tm_shape(boulder) + 
  ## which variable, is there a class interval, palette, and other options
  tm_symbols(col='PT_Elev', 
             style='quantile', 
             palette = 'YlOrRd',
             border.lwd = NA,
             size = 0.1)
```
```{r}
## here we are using a simple dataset of the world 
# tmap_mode("plot")
data("World")
tm_shape(World) +
    tm_polygons("gdp_cap_est", style='quantile', legend.title = "GDP Per Capita Estimate")
```
```{r}
## the view mode creates an interactive map
tmap_mode("view")
```

```{r}
tm_shape(World) +
    tm_polygons("gdp_cap_est", style='quantile', legend.title = "GDP Per Capita Estimate")
```

# Question 1
Discuss the advantages and challenges associated with an open data science approach. Provide an example based on this week’s reading. (1-2 paragraphs)

An open data science approach enhances geographic insight by converting data-scarce areas into rich, interconnected datasets. This shift allows for dynamic, detailed analyses at larger scales and lower costs (Kitchin, 2013). Sharing data, code, and methods increases the visibility and public value of geography, as much of today’s "big data" includes spatial attributes that promote wider reuse (Kitchin, 2013).

Open data science faces challenges such as uneven access, data quality, and coverage issues, particularly with volunteered sources like OpenStreetMap. There are also skills gaps for managing high-volume data and risks like naïve empiricism, which can overlook theory and small-data methods  (Kitchin, 2013). For instance, while volunteered data can enhance urban and social research, it still has limitations in access, quality, and scope, requiring careful interpretation based on theory (Kitchin, 2013).

(Reference: Kitchin, R. (2013). Big data and human geography: Opportunities, challenges and risks. Dialogues in Human Geography, 3(3), 262–267.)

# Question 2
## The Geography of Longevity: Linking GDP per Capita to Life Expectancy

### Introduction

This analysis employs an open and reproducible R workflow to examine how life expectancy varies across countries in relation to GDP per capita using the `spData::world` dataset. I provide two visualizations: (1) an interactive choropleth map showing life expectancy for easy spatial comparison, and (2) a scatter plot that illustrates the relationship between life expectancy and GDP per capita on a logarithmic scale, highlighting overall trends and regional patterns.

The map features a perceptually uniform color ramp, clear titles, and a legend, with interactive zooming and pop-ups for country inspection. The scatter plot uses a logarithmic x-axis, continent colors for regional context, and a LOESS smoother to summarize trends. The map offers spatial context, while the chart illustrates the strength and nature of the relationship.


### Data Preparation for Geovisualization

```{r}
library(sf)
library(spData) # world data
library(leaflet)
library(scales)

world <- spData::world |> st_as_sf() |> st_transform(4326)
```

### Map Rendering & Styling (Life Expectancy)

```{r}
pal <- colorNumeric("viridis", domain = world$lifeExp, na.color = "#cccccc")

leaflet(world, options = leafletOptions(minZoom = 1)) |>
  addProviderTiles(providers$CartoDB.Positron) |>
  addPolygons(
    fillColor = ~pal(lifeExp), color = "#666", weight = 0.4,
    fillOpacity = 0.9, smoothFactor = 0.2,
    label = ~paste0(name_long, ": ", round(lifeExp, 1), " yrs"),
    highlightOptions = highlightOptions(weight = 2, color = "#000", bringToFront = TRUE)
  ) |>
  addLegend(pal = pal, values = ~lifeExp, opacity = 0.9,
            title = "Life expectancy (yrs)",
            position = "bottomright") |>
  fitBounds(lng1 = -170, lat1 = -55, lng2 = 170, lat2 = 75)

```

### Data Loading and Preparation (Life Expectancy & GDP)

```{r}
library(sf)
library(spData)    
library(dplyr)
library(ggplot2)
library(viridis)
library(scales)

# 1) Load data 
world <- spData::world |> st_as_sf()

# 2) Prepare a tidy frame for plotting (drop geometry & NAs; keep positive GDP)
world_df <- world |>
  st_drop_geometry() |>
  filter(!is.na(lifeExp), !is.na(gdpPercap), gdpPercap > 0)
```

### Visualize Relationship by Continent

```{r}
# 3) Chart: GDP per capita (log scale) vs Life expectancy
p <- ggplot(world_df, aes(x = gdpPercap, y = lifeExp, color = continent)) +
  geom_point(alpha = 0.85, size = 2) +
  # smooth shows overall trend; grey so it doesn't fight the colors
  geom_smooth(method = "loess", se = TRUE, color = "grey20", linewidth = 0.9) +
  scale_x_log10(labels = label_dollar()) +
  scale_color_viridis_d(option = "turbo", name = "Continent") +
  theme_bw() +
  labs(
    title = "Life Expectancy Rises with GDP per Capita",
    subtitle = "Log scale on GDP per capita; LOESS smooth (grey) summarizes the relationship",
    x = "GDP per capita (log scale)",
    y = "Life expectancy (years)",
    caption = "Source: spData::world (CRAN)"
  )

p

```

### Discussion

The interactive map highlights the geography of longevity. Countries in Europe, North America, Oceania, and parts of East Asia have the highest life expectancies. In contrast, sub-Saharan Africa and some conflict-affected areas show much lower life expectancies. Latin America and North Africa fall in the upper-middle range, with significant variations within those regions, such as between the Southern Cone and the Andean states. Island nations and small economies can also be exceptions, indicating that national averages may hide internal disparities.

The scatter plot links GDP per capita (on a logarithmic scale) to life expectancy, showing a strong non-linear relationship. Significant increases in life expectancy occur at low income levels, but the gains diminish beyond the upper-middle-income range. The LOESS curve levels off at high GDP, suggesting that once basic needs—like nutrition, sanitation, and education—are met, additional income provides smaller health benefits.

Continental color coding reveals groupings (e.g., high GDP and life expectancy in Europe and parts of Asia, and lower figures in Africa). However, some countries outperform others at similar income levels due to better policies and institutions.

Some countries have higher life expectancy than expected for their income, indicating strong public health systems or social protections. Others lag due to issues like conflict, epidemics, or poor governance. The log-scaled x-axis shows that increases in income have varying impacts on health; for example, going from $1k to $10k GDP yields a greater health benefit than increasing from $30k to $60k.

### Conclusion

The results reveal a clear geography of longevity, with higher life expectancy in Europe, North America, Oceania, and parts of East Asia, while lower values are found in sub-Saharan Africa and conflict-affected areas. There is a strong, non-linear relationship between income and longevity, showing significant gains at lower income levels and diminishing returns at upper-middle-income levels.

Income facilitates access to essential services like nutrition and healthcare, leading to substantial health improvements initially. However, as income rises, additional years of life depend more on the quality of health systems and preventive measures.

Important considerations include the fact that national averages can mask within-country inequalities, GDP per capita does not reflect income distribution, and correlation does not imply causation. Future studies could add factors such as education and health spending to better understand health outcomes.

Ultimately, the analysis highlights that investments in basic public health services in lower-income areas yield the largest gains in life expectancy, while higher-income contexts should focus on quality, prevention, and equity for further improvements.

### Version Control

![Git history screenshot](Screenshot 2025-10-28 160140.png)


  
